#!/bin/bash
#
TLIST=$1
DLIST=$2

############################################
################-->GUI<--###################
yad --separator="," --plug=$$ --tabnum=1 --columns=3 --form --field="Severity":cb unknown\!critical\!high\!medium\!low\!info --field="Directory":dir /root/nuclei-templates/ --field="Tag1": --field="Tag2": --field="Keywords":lbl --field="name":chk --field="product":chk --field="vendor":chk --field="Modifiers":lbl --field="http.title:[D]":chk --field="http.server:[D]":chk --field="powered.by:[D]":chk|tee tmp &

yad --separator="," --columns=2 --form --plug=$$ --tabnum=2 --field="rate-limit:scl" 1..99\!5\!5 --field="concurrency:scl" 1..99\!5\!5 --field="hosts-tmplt:scl" 1..99\!5\!5 --field="Attack-Type:cb" clusterbomb\!pitchfork\!batteringram --field=Scan-Strategy:cb template-spray\!host-spray --field="env-variables":chk --field="system-resolvers":chk --field="host-redirects":chk | \
yad --geometry=500x900+100+200 --separator="," --borders=30 --orient=vert --title="Configuration" --paned --key=$$
##############################################
###############-->CONFIG<--###################
SVR=$(csvtool col 1 tmp)
DIR=$(csvtool col 2 tmp)
T1=$(csvtool col 3 tmp)
echo >> $PDIR/*.cfg "severity=$SVR"
echo >> $PDIR/*.cfg "tmpltDir=$DIR"
echo >> $PDIR/*.cfg "tag1=$T1"
nuclei -nc -silent -tl -severity $SVR -t $DIR -tags $T1 |tee $TLIST

T2=$(csvtool col 4 tmp)
if [ -z $T2 ]
then
    unset $T2
else
    echo >> $PDIR/*.cfg "tag2=$T2"
    nuclei -nc -silent -tl -t $TLIST -tags $T2|tee $TLIST
fi


######################################
#########--> Dork Parser <--##########
NM=$(csvtool col 6 tmp)
if [ $NM == FALSE ]
then
    unset $NM
else
    KWORD="name"
fi
PRD=$(csvtool col 7 tmp)
if [ $PRD == FALSE ]
then
    unset $PRD
else
    KWORD='product'
fi
VEN=$(csvtool col 8 tmp)
if [ $VEN == FALSE ]
then
    unset $VEN
else
    KWORD='vendor'
fi
nuclei -nc -silent -td -t $TLIST|grep $KWORD|sed s/"$KWORD"://g|sed s/\ \//g|tee -a $DLIST






#M1=$(csvtool col 10 tmp)
#M2=$(csvtool col 11 tmp)
#M3=$(csvtool col 12 tmp)






